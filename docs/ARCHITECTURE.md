# ARCHITECTURE.md (Modular, AI-Ready)

## 1. ĞĞ±Ñ‰Ğ°Ñ ĞºĞ¾Ğ½Ñ†ĞµĞ¿Ñ†Ğ¸Ñ

ĞŸÑ€Ğ¾ĞµĞºÑ‚ Ğ¿Ğ¾ÑÑ‚Ñ€Ğ¾ĞµĞ½ Ğ¿Ğ¾ **Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒĞ½Ğ¾Ğ¹ feature-based Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğµ**, Ğ³Ğ´Ğµ:

* ĞºĞ°Ğ¶Ğ´Ğ°Ñ Ñ„Ğ¸Ñ‡Ğ° â€” **Ğ¸Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ**
* Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ **Ğ½Ğµ Ğ·Ğ½Ğ°ÑÑ‚ Ğ´Ñ€ÑƒĞ³ Ğ¾ Ğ´Ñ€ÑƒĞ³Ğµ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ**
* Ğ²Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ â€” Ñ‡ĞµÑ€ĞµĞ· **Application Layer Ğ¸Ğ»Ğ¸ Events**
* ĞºĞ¾Ğ´ Ğ»ĞµĞ³ĞºĞ¾ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ¸ Ñ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ÑÑ Ğ˜Ğ˜

ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ÑĞ¾Ñ‡ĞµÑ‚Ğ°ĞµÑ‚:

* Modular Monolith
* Clean Architecture
* Domain-Driven Design (lite)
* AI-friendly constraints

---

## 2. Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚ĞµĞº

* **NestJS** â€” Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ¸ DI
* **discord.js** â€” Discord API
* **Prisma** â€” ORM
* **PostgreSQL** â€” Ğ‘Ğ”
* **@nestjs/event-emitter** â€” Ğ¼ĞµĞ¶Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒĞ½Ñ‹Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
* **class-validator** â€” Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ
* **OpenAI / LLM SDK** â€” Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ (AI-Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ)

---

## 3. ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ½Ğ° Ğ²Ñ‹ÑĞ¾ĞºĞ¾Ğ¼ ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ

```
Discord (Events / Commands)
        â†“
Feature Discord Gateways
        â†“
Feature Application Layer (Use Cases)
        â†“
Feature Domain
        â†“
Shared Infrastructure (Prisma, AI, External APIs)
```

âš ï¸ **ĞšĞ°Ğ¶Ğ´Ğ°Ñ Ñ„Ğ¸Ñ‡Ğ° Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ°Ğ²Ñ‚Ğ¾Ğ½Ğ¾Ğ¼Ğ½Ğ°**

---

## 4. Feature-based ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

```
src/
â”œâ”€â”€ app.module.ts
â”œâ”€â”€ main.ts
â”‚
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ user/
â”‚   â”‚   â”œâ”€â”€ user.module.ts
â”‚   â”‚   â”œâ”€â”€ discord/
â”‚   â”‚   â”œâ”€â”€ application/
â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â””â”€â”€ infrastructure/
â”‚   â”‚
â”‚   â”œâ”€â”€ moderation/
â”‚   â”œâ”€â”€ economy/
â”‚   â”œâ”€â”€ ai/
â”‚   â””â”€â”€ analytics/
â”‚
â”œâ”€â”€ shared/
â”‚   â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ discord/
â”‚   â”œâ”€â”€ ai/
â”‚   â”œâ”€â”€ config/
â”‚   â””â”€â”€ common/
```

---

## 5. Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ„Ğ¸Ñ‡Ğ¸ (ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ)

```
features/<feature-name>/
â”œâ”€â”€ <feature>.module.ts
â”‚
â”œâ”€â”€ discord/           # Discord gateway / commands
â”‚   â””â”€â”€ *.command.ts
â”‚
â”œâ”€â”€ application/       # Use-cases
â”‚   â””â”€â”€ *.use-case.ts
â”‚
â”œâ”€â”€ domain/            # Ğ§Ğ¸ÑÑ‚Ğ°Ñ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°
â”‚   â”œâ”€â”€ entities/
â”‚   â”œâ”€â”€ value-objects/
â”‚   â”œâ”€â”€ services/
â”‚   â””â”€â”€ repositories/
â”‚
â”œâ”€â”€ infrastructure/    # Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ¾Ğ²
â”‚   â”œâ”€â”€ repositories/
â”‚   â””â”€â”€ adapters/
```

---

## 6. Dependency Rules (ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§ĞĞ)

### Ğ Ğ°Ğ·Ñ€ĞµÑˆÑ‘Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸

```
discord â†’ application â†’ domain
infrastructure â†’ domain
shared â†’ features
```

### Ğ—Ğ°Ğ¿Ñ€ĞµÑ‰ĞµĞ½Ğ¾ âŒ

* âŒ feature â†’ feature (Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ)
* âŒ domain â†’ nestjs
* âŒ domain â†’ prisma
* âŒ application â†’ discord
* âŒ discord â†’ prisma

---

## 7. ĞĞ±Ñ‰Ğ¸Ğµ (Shared) Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸

### 7.1 Prisma (Ğ¾Ğ±Ñ‰Ğ¸Ğ¹)

```
shared/prisma/
â”œâ”€â”€ prisma.module.ts
â”œâ”€â”€ prisma.service.ts
```

Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ **Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾** Ğ² `infrastructure`. ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ½Ğµ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ â€” Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² Ñ‚ĞµÑ… Ğ¼Ğ¾Ğ´ÑƒĞ»ÑÑ… Ñ„Ğ¸Ñ‡, Ğ³Ğ´Ğµ ĞµÑÑ‚ÑŒ ÑĞ»Ğ¾Ğ¹ infrastructure, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‰Ğ¸Ğ¹ Ğ‘Ğ”.

---

### 7.2 Discord Core

```
shared/discord/
â”œâ”€â”€ discord.module.ts
â”œâ”€â”€ discord-ready.listener.ts
â”œâ”€â”€ normalize-token.ts
```

ĞšĞ»Ğ¸ĞµĞ½Ñ‚ ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· **NecordModule**. Ğ¤Ğ¸Ñ‡Ğ¸ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒÑÑ‚ ÑĞ²Ğ¾Ğ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ² ÑĞ²Ğ¾Ğ¸Ñ… Ğ¼Ğ¾Ğ´ÑƒĞ»ÑÑ…, Ğ¾Ğ±Ñ‰Ğ¸Ğ¹ listener (ready Ğ¸ Ñ‚.Ğ¿.) â€” Ğ² shared.

---

### 7.3 AI Module (Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ)

```
shared/ai/
â”œâ”€â”€ ai.module.ts
â”œâ”€â”€ ai.service.ts
â”œâ”€â”€ prompts/
â”‚   â””â”€â”€ *.prompt.ts
```

Ğ¤Ğ¸Ñ‡Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ Ğ˜Ğ˜ **Ñ‡ĞµÑ€ĞµĞ· Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑÑ‹**, Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€:

```ts
interface AiTextService {
  generate(prompt: string): Promise<string>;
}
```

---

## 8. ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ˜Ğ˜ (feature/ai)

Ğ˜Ğ˜ â€” **Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ°Ñ Ñ„Ğ¸Ñ‡Ğ°**, Ğ° Ğ½Ğµ ÑƒÑ‚Ğ¸Ğ»Ğ¸Ñ‚Ğ°.

```
features/ai/
â”œâ”€â”€ ai.module.ts
â”œâ”€â”€ application/
â”‚   â””â”€â”€ ask-ai.use-case.ts
â”œâ”€â”€ domain/
â”‚   â””â”€â”€ ai-task.entity.ts
â”œâ”€â”€ infrastructure/
â”‚   â””â”€â”€ openai.adapter.ts
```

â¡ï¸ Ğ­Ñ‚Ğ¾ Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚:

* Ğ¼ĞµĞ½ÑÑ‚ÑŒ LLM Ğ±ĞµĞ· Ñ€ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°
* Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ°Ñ‚ÑŒ Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ²
* Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ˜Ğ˜ ĞºĞ°Ğº tool Ğ´Ğ»Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… Ñ„Ğ¸Ñ‡

---

## 9. Ğ’Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ğ¼ĞµĞ¶Ğ´Ñƒ Ñ„Ğ¸Ñ‡Ğ°Ğ¼Ğ¸

### âŒ ĞĞ•Ğ›Ğ¬Ğ—Ğ¯

```ts
UserService â†’ EconomyService
```

### âœ… ĞœĞĞ–ĞĞ

#### Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 1: Events

```ts
UserRegisteredEvent
```

#### Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 2: Application API

```ts
UserApplicationService
```

---

## 10. Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ğ˜Ğ˜ ğŸ¤– (ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ğµ)

### Ğ˜Ğ˜ ĞĞ‘Ğ¯Ğ—ĞĞ:

1. Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ **Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ„Ğ¸Ñ‡Ğ¸**
2. Ğ¡Ğ¾Ğ±Ğ»ÑĞ´Ğ°Ñ‚ÑŒ feature boundaries
3. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ:

   * domain â†’ interface
   * infrastructure â†’ implementation
4. Use-case = **Ğ¾Ğ´Ğ½Ğ° Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ**
5. ĞĞµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ shared Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ Ğ´Ğ»Ñ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸
6. ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ñ€Ğ°ÑÑˆĞ¸Ñ€ÑĞµĞ¼Ğ¾ÑÑ‚ÑŒ Ğ¿Ğ¾Ğ´ AI

### Ğ˜Ğ˜ Ğ—ĞĞŸĞ Ğ•Ğ©Ğ•ĞĞ âŒ

* Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ PrismaClient Ğ²Ğ½Ğµ infrastructure
* Ğ”ĞµĞ»Ğ°Ñ‚ÑŒ shared "god-module"
* ĞŸĞ¸ÑĞ°Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ Ğ² Discord handlers
* Ğ¡Ğ²ÑĞ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ñ„Ğ¸Ñ‡Ğ¸ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ

---

## 11. Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ² ğŸ‘¨â€ğŸ’»

### Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ Ñ„Ğ¸Ñ‡Ğ¸

1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ğ°Ğ¿ĞºÑƒ `features/<name>`
2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ `<name>.module.ts`
3. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ»Ğ¾Ğ¸ (discord/application/domain/infrastructure)
4. ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ² `AppModule`
5. Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ **application API**

---

### Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ˜Ğ˜ Ğ² Ñ„Ğ¸Ñ‡Ñƒ

1. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ¸Ğ· domain
2. Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ¸Ğ· `shared/ai`
3. ĞĞµ Ğ¿Ñ€Ğ¸Ğ²ÑĞ·Ñ‹Ğ²Ğ°Ñ‚ÑŒÑÑ Ğº ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ¼Ñƒ LLM

---

## 12. ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ ÑÑ‚Ğ° Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ° Ğ´Ğ»Ñ Ğ˜Ğ˜

* Ğ¯Ğ²Ğ½Ñ‹Ğµ Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ â†’ Ğ¼ĞµĞ½ÑŒÑˆĞµ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
* ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€ÑĞµĞ¼Ñ‹Ğµ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹
* ĞœĞµĞ½ÑŒÑˆĞµ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ° = Ğ»ÑƒÑ‡ÑˆĞµ ĞºĞ¾Ğ´
* Ğ˜Ğ˜ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ°Ñ‚ÑŒ **ĞºĞ°Ğº Ñ„Ğ¸Ñ‡Ñƒ, ĞºĞ°Ğº ÑĞµÑ€Ğ²Ğ¸Ñ, ĞºĞ°Ğº Ğ°Ğ³ĞµĞ½Ñ‚Ğ°**
